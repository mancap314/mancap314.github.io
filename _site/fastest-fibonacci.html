<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title> The Fastest Way to Compute the Fibonacci Sequence</title>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <!-- Load an icon library to show a hamburger menu (bars) on small screens -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="assets/js/switch.js"></script>
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>The Fastest Way to Compute the Fibonacci Sequence | Data science and other stuffs</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="The Fastest Way to Compute the Fibonacci Sequence" />
<meta name="author" content="Manuel Capel" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="What is the Fibonacci sequence? It’s easy to define: the first element is 1, the second is 2, and the following elements are the sum of the two previous ones: the 3rd element is 3 (2 +1), the 4th is 5 (3+2), the 5th is 8 (5+3) etc." />
<meta property="og:description" content="What is the Fibonacci sequence? It’s easy to define: the first element is 1, the second is 2, and the following elements are the sum of the two previous ones: the 3rd element is 3 (2 +1), the 4th is 5 (3+2), the 5th is 8 (5+3) etc." />
<link rel="canonical" href="http://localhost:4000/fastest-fibonacci.html" />
<meta property="og:url" content="http://localhost:4000/fastest-fibonacci.html" />
<meta property="og:site_name" content="Data science and other stuffs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-10T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="The Fastest Way to Compute the Fibonacci Sequence" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"The Fastest Way to Compute the Fibonacci Sequence","dateModified":"2020-08-10T00:00:00+02:00","datePublished":"2020-08-10T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/fastest-fibonacci.html"},"url":"http://localhost:4000/fastest-fibonacci.html","author":{"@type":"Person","name":"Manuel Capel"},"description":"What is the Fibonacci sequence? It’s easy to define: the first element is 1, the second is 2, and the following elements are the sum of the two previous ones: the 3rd element is 3 (2 +1), the 4th is 5 (3+2), the 5th is 8 (5+3) etc.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135039700-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-135039700-1');
    </script>
  </head>
  <body>
    <nav class="navigation">
  <div>
    <p><em> A blog about data science, computer viruses, mathematics etc.</em></p>
    
      <a href="/" >Home</a>
    
      <a href="/about.html" >About</a>
    
      <a href="/contact.html" >Contact</a>
    
  </div>
</nav>
<div class="spacer-top">
  &nbsp;
</div>

    <div class="main-content">
      <h1>The Fastest Way to Compute the Fibonacci Sequence</h1>
      
<div class="post-desc horizontal-list">
  <ul>
    <li>10 Aug 2020</li>
    <li>Manuel Capel</li>
    <li>Tags: <a href="/miscellanous/">miscellanous</a></li>
  </ul>
</div>

      <p>What is the <a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci sequence</a>? It’s easy to define: the first element is 1, the second is 2, and the following elements are the sum of the two previous ones: the 3rd element is 3 (2 +1), the 4th is 5 (3+2), the 5th is 8 (5+3) etc.</p>

<p>Tonight on the Python <a href="https://discord.com/">Discord</a> channel, a user came up with a challenge: find a faster Python implementation to compute the elements of the Fibonacci sequence than this one:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">TypeError</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">b</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Challenge accepted. I already knew there is a closed form (direct formula) to compute the Fibonacci values, so I thought it would be enough to apply it directly to beat this implementation… but it was not that easy</p>

<h2 id="binet-formula">Binet Formula</h2>

<p>There is a closed form called <a href="http://mathonline.wikidot.com/a-closed-form-of-the-fibonacci-sequence">Binet formula</a> for computing the n-th Fibonacci value. Translated in Python (with numpy), it gives:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Perfect. Note also the <a href="https://en.wikipedia.org/wiki/Golden_ratio">golden ratio</a> in the formula. What is the problem with this? Let’s try it out:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">fibonacci</span><span class="p">(</span><span class="mi">1500</span><span class="p">)</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">manuel</span><span class="o">/</span><span class="p">.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">ipykernel_launcher</span><span class="p">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span> <span class="nb">RuntimeWarning</span><span class="p">:</span> <span class="n">overflow</span> <span class="n">encountered</span> <span class="ow">in</span> <span class="n">double_scalars</span>
<span class="n">inf</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>So when trying to compute the 1500th Fibonacci value, we get an overflow and an infinite result… This Binet formula doesn’t seem to work in practice. But… we can modify it on order to make it computable.</p>

<h2 id="trick-1-splitting-the-powers">Trick 1: Splitting the Powers</h2>

<p>We can expand and simplify this term: <code class="language-plaintext highlighter-rouge">(1 + np.sqrt(5)) / 2) ** n - ((1 - np.sqrt(5)) / 2) ** n)</code> by using the binomial theorem:</p>

<p><img src="assets/fibonacci-binomial-expansion.png" alt="binomial-expansion" title="Binomial Expansion" /></p>

<p>The terms in the sum are smaller, but still not small enough. For <code class="language-plaintext highlighter-rouge">n &gt; 1000</code> we still get infinity result, so we need another trick:</p>

<h2 id="trick-2-log-down">Trick 2: Log Down</h2>

<p>The terms in the sum just consist in multiplication and power operation, so it calls for using logarithm. Bear in mind the basic logarithm property: <code class="language-plaintext highlighter-rouge">log(a.b) = log(a) + log(b)</code> and that the bigger <code class="language-plaintext highlighter-rouge">n</code>, the smallest <code class="language-plaintext highlighter-rouge">log(n)</code> compared to n. So we get:</p>

<p><img src="assets/fibonacci-1st-log-expansion.png" alt="first-log-expansion" title="First Log Expansion" /></p>

<p>where <code class="language-plaintext highlighter-rouge">ln</code> here stands for the <a href="https://en.wikipedia.org/wiki/Natural_logarithm">natural logarithm</a>. That’s already a big improvement, but we still have a problem: The binomial factor gets too high before we take its log. The solution is thus to inject the log directly into it:</p>

<p><img src="assets/fibonacci-2nd-log-expansion.png" alt="second-log-expansion" title="Second Log Expansion" /></p>

<p>Note that the last two sums are the same made in reversed order.</p>

<p>So we just have to implement this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>


<span class="k">def</span> <span class="nf">log_binom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ks</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">z1</span> <span class="o">=</span> <span class="n">z</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">z1</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">uint32</span><span class="p">)</span>
    <span class="n">coeffs</span> <span class="o">=</span> <span class="n">log_binom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span>  <span class="mi">2</span> <span class="o">*</span> <span class="n">ks</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="mi">2</span><span class="o">*</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">m</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you are attentive you can see three additional tricks used here:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">res = np.subtract(res, np.log(2)*(n-1) + np.log(np.sqrt(5)))</code>: is the logarithmic equivalent of dividing by <code class="language-plaintext highlighter-rouge">sqrt(5)</code> and by <code class="language-plaintext highlighter-rouge">2^(n-1)</code> in the Binet Formula</li>
  <li>The elements in the array are divided by <code class="language-plaintext highlighter-rouge">m</code>, the max element of the array, in order to avoid hitting infinity in the following sum</li>
  <li><code class="language-plaintext highlighter-rouge">fibonacci()</code> returns <code class="language-plaintext highlighter-rouge">res</code> and <code class="language-plaintext highlighter-rouge">m</code>. The result is in fact <code class="language-plaintext highlighter-rouge">res.exp(m)</code> but encoding it like that with two numbers avoids hitting the format width limit for integers.</li>
</ul>

<h2 id="results">Results</h2>

<p>The challenge was to beat the performance of the <code class="language-plaintext highlighter-rouge">fib()</code> function above. Let’s see what we get for large <code class="language-plaintext highlighter-rouge">n</code> (you have to scroll a bit down the result, sorry):</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">timeit</span><span class="p">,</span> <span class="n">functools</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">t_fib</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">functools</span><span class="p">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fib</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> 
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'performance fib(): </span><span class="si">{</span><span class="n">t_fib</span><span class="p">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'fib(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s">)=</span><span class="si">{</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

<span class="k">print</span><span class="p">()</span>

<span class="n">t_fibonacci</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">functools</span><span class="p">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> 
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'performance fibonacci(): </span><span class="si">{</span><span class="n">t_fibonacci</span><span class="p">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'fibonacci(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s">)=</span><span class="si">{</span><span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span><span class="n">performance</span> <span class="n">fib</span><span class="p">():</span> <span class="mf">0.019920013000955805</span>
<span class="n">fib</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span><span class="o">=</span><span class="mi">54438373113565281338734260993750380135389184554695967026247715841208582865622349017083051547938960541173822675978026317384359584751116241439174702642959169925586334117906063048089793531476108466259072759367899150677960088306597966641965824937721800381441158841042480997984696487375337180028163763317781927941101369262750979509800713596718023814710669912644214775254478587674568963808002962265133111359929762726679441400101575800043510777465935805362502461707918059226414679005690752321895868142367849593880756423483754386342639635970733756260098962462668746112041739819404875062443709868654315626847186195620146126642232711815040367018825205314845875817193533529827837800351902529239517836689467661917953884712441028463935449484614450778762529520961887597272889220768537396475869543159172434537193611263743926337313005896167248051737986306368115003088396749587102619524631352447499505204198305187168321623283859794627245919771454628218399695789223798912199431775469705216131081096559950638297261253848242007897109054754028438149611930465061866170122983288964352733750792786069444761853525144421077928045979904561298129423809156055033032338919609162236698759922782923191896688017718575555520994653320128446502371153715141749290913104897203455577507196645425232862022019506091483585223882711016708433051169942115775151255510251655931888164048344129557038825477521111577395780115868397072602565614824956460538700280331311861485399805397031555727529693399586079850381581446276433858828529535803424850845426446471681531001533180479567436396815653326152509571127480411928196022148849148284389124178520174507305538928717857923509417743383331506898239354421988805429332440371194867215543576548565499134519271098919802665184564927827827212957649240235507595558205647569365394873317659000206373126570643509709482649710038733517477713403319028105575667931789470024118803094604034362953471997461392274791549730356412633074230824051999996101549784667340458326852960388301120765629245998136251652347093963049734046445106365304163630823669242257761468288461791843224793434406079917883360676846711185597501</span><span class="n">performance</span> <span class="n">fibonacci</span><span class="p">():</span> <span class="mf">0.005696072999853641</span>
<span class="n">fibonacci</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span><span class="o">=</span><span class="p">(</span><span class="mf">57.919468677010926</span><span class="p">,</span> <span class="mf">4807.735689890051</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For <code class="language-plaintext highlighter-rouge">n=10000</code> our implementation is about 3.5x faster than the original implementation, challenge completed! (and this gap increases with <code class="language-plaintext highlighter-rouge">n</code>). Also, notice that the 10000th term of the Fibonacci sequence is pretty huge.</p>

<p>To the best of our knowledge, this way of using the Binet formula (with the tricks) has never been used so far. <a href="https://arxiv.org/pdf/1803.07199.pdf">This paper</a> for example mentions the Binet closed form, but in its direct expression which, as we saw, throws an overflow or returns infinity value for large n.</p>

<p>Note also that our algorithm is completely parallelizable.</p>

<p>It would be also interesting to compare the performance of this algorithm with the <a href="https://www.nayuki.io/page/fast-fibonacci-algorithms">fast doubling</a>, considered as the fastest algorithm for computing Fibonacci values, in its provided <a href="https://www.nayuki.io/res/fast-fibonacci-algorithms/fastfibonacci.py">Python implementation</a>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">fibonacci_fd</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">"Negative arguments not implemented"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_fib_fd</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="c1"># (Private) Returns the tuple (F(n), F(n+1)).
</span><span class="k">def</span> <span class="nf">_fib_fd</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">_fib_fd</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span><span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">t_fibonacci</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">functools</span><span class="p">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> 
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'performance fibonacci(): </span><span class="si">{</span><span class="n">t_fibonacci</span><span class="p">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

    <span class="k">print</span><span class="p">()</span>

    <span class="n">t_fibonacci_fd</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">functools</span><span class="p">.</span><span class="n">partial</span><span class="p">(</span><span class="n">fibonacci_fd</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> 
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">'performance fibonacci_fd() (fast doubling): </span><span class="si">{</span><span class="n">t_fibonacci_fd</span><span class="p">.</span><span class="n">timeit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>First try with small <code class="language-plaintext highlighter-rouge">n=1000</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>compare<span class="o">(</span>1000<span class="o">)</span>
performance fibonacci<span class="o">()</span>: 0.004257305001374334
performance fibonacci_fd<span class="o">()</span> <span class="o">(</span>fast doubling<span class="o">)</span>: 0.00013275300443638116
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In this case, the <em>fast doubling</em> algorithm is about 30x faster than our algorithm.</p>

<p>Let’s take now a bigger <code class="language-plaintext highlighter-rouge">n = 100000</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>compare<span class="o">(</span>100000<span class="o">)</span>
performance fibonacci<span class="o">()</span>: 0.06739291800477076
performance fibonacci_fd<span class="o">()</span> <span class="o">(</span>fast doubling<span class="o">)</span>: 0.019004731002496555
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now <em>fast doubling</em> is only 3.5x faster.</p>

<p>And with an even bigger <code class="language-plaintext highlighter-rouge">n=2000000</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>compare<span class="o">(</span>2000000<span class="o">)</span>
performance fibonacci<span class="o">()</span>: 1.1456952699954854
performance fibonacci_fd<span class="o">()</span> <span class="o">(</span>fast doubling<span class="o">)</span>: 1.68371414799185
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This time, our algorithm is about 30% faster than <em>fast doubling</em> which was considered so far the fastest Fibonacci algorithm.</p>

      <hr>
      <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<div id="share-bar">
  <h4>Share this:</h4>
  <div class="share-buttons">
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/fastest-fibonacci.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><em class="fa fa-facebook-official share-button"> facebook</em></a>
    <a href="https://twitter.com/intent/tweet?text=The Fastest Way to Compute the Fibonacci Sequence&url=http://localhost:4000/fastest-fibonacci.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><em class="fa fa-twitter share-button"> twitter</em></a>
    <a href="https://plus.google.com/share?url=http://localhost:4000/fastest-fibonacci.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google+"><em class="fa fa-google-plus share-button"> google</em></a>
    <a href="http://pinterest.com/pin/create/button/?url=http://localhost:4000/fastest-fibonacci.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pinterest"><em class="fa fa-pinterest-p share-button"> pinterest</em></a>
    <a href="http://www.tumblr.com/share/link?url=http://localhost:4000/fastest-fibonacci.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Tumblr"><em class="fa fa-tumblr share-button"> tumblr</em></a>
    <a href="http://www.reddit.com/submit?url=http://localhost:4000/fastest-fibonacci.html" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit"><em class="fa fa-reddit-alien share-button"> reddit</em></a>
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/fastest-fibonacci.html&title=The Fastest Way to Compute the Fibonacci Sequence&summary=&source=Data science and other stuffs" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><em class="fa fa-linkedin share-button"> linkedin</em></a>
    <a href="mailto:?subject=The Fastest Way to Compute the Fibonacci Sequence&amp;body=Check out this site http://localhost:4000/fastest-fibonacci.html" title="Share via Email"><em class="fa fa-envelope share-button"> email</em></a>
  </div>
</div>

      <hr>
      
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/fastest-fibonacci.html';
      this.page.identifier = 'http://localhost:4000/fastest-fibonacci.html';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://mc-data.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


    </div>
  </body>
</html>
